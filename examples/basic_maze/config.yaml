log_level: info
experiment_path: .
experiment_output_path: "{PROJECT_ROOT}/output"

plugins:
  # Primary pose estimation data (establishes temporal index)
  - name: pose_data
    type: pose_tracking
    file_pattern: '.*DLC.*\.h5$'  # Match DeepLabCut H5 files
    config:
      bodypart: 'Nose'
      likelihood_threshold: 0.3
      bodyparts: 'all'

  # Camera calibration transformation matrix
  - name: calibration_matrix
    type: calibration
    shared: true  # Look in resources folder
    file_pattern: 'transform_matrix\.npy$'
    config: {}

  # Spatial coordinate transformation and tile detection
  - name: map_coords
    type: map_location
    shared: true  # Map is shared across sessions
    file_pattern: '.*maze_map\.png$'  # Match maze map image
    config:
      bodypart: 'Nose'  # Which bodypart to track for map coordinates

  # Graph-based spatial navigation analysis
  - name: graph_coords
    type: graph_location
    shared: true  # Graph is shared across sessions
    config:
      reward_tile_id: 273  # Tile ID for reward location

graph:
  builder:
    type: binary_tree
    config:
      height: 7
  mapping_file: ./resources/graph_mapping.pkl
  conflict_strategy: node_priority

analyze:
  metrics:
    time_to_reward: 
      func_name: 'time_a_to_b'
      args: 
        a: 145
        b: 273
    
    velocity_to_reward:
      func_name: 'velocity_a_to_b'
      args:
        a: 145
        b: 273
    
    exploration_percentage:
      func_name: 'exploration_percentage'

  save_as_csv: true
  save_as_pkl: true
  save_raw_data_as_pkl: true

# Visualization configuration (used when running with visualize mode)
visualizations:
  output:
    enabled: true
    path: ./output/videos
    format: mp4
    fps: 30
    codec: mp4v
    
  pipeline:
    - name: bodypart_display
      type: bodyparts
      config:
        bodyparts: ['Nose', 'Tail_base']
        colors:
          Nose: [0, 255, 0]      # Green
          Tail_base: [255, 0, 0] # Blue
        radius: 6
        show_labels: false
        likelihood_threshold: 0.3
        
    - name: trajectory_trail
      type: trajectory
      config:
        bodypart: 'Nose'
        coordinate_type: 'pixel'
        trail_length: 100
        fade_trail: true
        current_color: [0, 0, 255]    # Red
        trail_color: [255, 255, 0]    # Cyan
        current_radius: 4
        
    - name: map_overlay_display
      type: map_overlay
      config:
        position: 'bottom_right'
        size: 0.25
        opacity: 0.8
        highlight_current: true
        show_visited: true
        current_tile_color: [0, 0, 255]     # Red
        visited_tile_color: [0, 255, 0]     # Green
        visited_opacity: 0.4
        show_tile_ids: true
        
    - name: text_info
      type: text_display
      config:
        columns: ['tile_id', 'graph_node_id']
        position: 'top_left'
        font_scale: 0.7
        color: [255, 255, 255]              # White
        background: true
        background_opacity: 0.7
        decimal_places: 0