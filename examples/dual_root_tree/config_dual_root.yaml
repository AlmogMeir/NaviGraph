# Dual-Rooted Binary Tree Configuration Example
# This configuration demonstrates the new dual_root_binary_tree graph builder

# Logging and paths
log_level: info
experiment_path: .
experiment_output_path: "{PROJECT_ROOT}/output"

# Setup configuration for GUI tools
setup:

  map_path: ./resources/maze_map.png  # Your experimental arena image
  spatial_image_for_calibration: ./resources/maze_images/NPC1_2025_08_24_11_35_08_blackout.png
  graph_mapping_output: ./resources/maze_mappings/NPC1_2025_08_24_11.pkl
  calibration_matrix: ./resources/transform_matrix.npy

# Video configuration
video:
  # Video path is now auto-discovered in session folder
  # Or use file_pattern to specify naming pattern
  file_pattern: ".*\\.mp4$"  # Finds any .mp4 file in session folder
  start_frame: 0  # Optional: start from specific frame
  end_frame: null  # Optional: process only up to this frame

# Plugin configuration - customize based on your data sources
plugins:
  - name: calibration_data
    type: calibration
    file_pattern: "transform_matrix\\.npy$"
    shared: true  # Calibration is in resources folder, not session folder
    
  - name: pose_data
    type: pose_tracking
    file_pattern: ".*\\.h5$"  # Finds .h5 files in session folder
    tracked_bodyparts: 
      - headstage
    likelihood_threshold: 0.3

  - name: graph_position
    type: graph_location
    graph_mapping_file: ./resources/maze_mappings/NPC1_2025_08_24_11.pkl
    conflict_strategy: node_priority

# Dual-rooted binary tree graph structure
graph:
  builder:
    type: dual_root_binary_tree
    config:
      left_height: 6   # Height of left tree (number of levels)
      right_height: 6  # Height of right tree (can be different from left)
  
  mapping_file: ./resources/maze_mappings/NPC1_2025_08_24_11.pkl
  conflict_strategy: node_priority

# Analysis metrics
analyze:
  output_file: "/var/home/almogmeir/Documents/GitHub/NaviGraph/examples/dual_root_tree/resources/outputs/NPC1_2025_08_24_analysis_results.pkl"  # Where to save results

  metrics: {}  # Empty metrics - add custom metrics here if needed
    # Example: measure time spent in specific regions
    # time_in_region:
    #   func_name: 'time_a_to_b'
    #   args:
    #     a: 0  # Start node
    #     b: 63  # End node
  
  save_as_pkl: true
  save_as_csv: true

# Visualization pipeline
visualizations:
  output:
    directory: "/var/home/almogmeir/Documents/GitHub/NaviGraph/examples/dual_root_tree/resources/outputs/visualizations"
    format: mp4
    fps: 40
    
  pipeline:
    # Show the maze map
    - name: maze_map
      type: map_overlay
      config:
        map_path: ./resources/maze_map.png
        alpha: 0.7
    
    # Overlay the dual-rooted tree structure
    - name: graph_structure
      type: graph_overlay
      config:
        show_nodes: true
        show_edges: true
        node_color_by: visits
        edge_width: 2
        highlight_active_node: true
    
    # Show tracked position
    - name: tracked_bodyparts
      type: bodyparts
      config:
        bodyparts:
          - headstage
        trail_length: 50
        marker_size: 5
    
    # Display metrics
    - name: session_info
      type: text_display
      config:
        columns:
          - frame
          - current_node_headstage
        position: top_left
